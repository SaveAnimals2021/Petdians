<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="org.petdians.animal.mapper.AnimalInfoMapper">

	<!-- Search Where -->
	<sql id="search">
		<where>
			<if test="arr != null">
				<foreach collection="arr" index="key" item="val" separator="OR" open="(" close=")">
					<if test="val == 't'.toString">
						title like concat('%', #{keyword}, '%')
					</if>
					<if test="val == 'c'.toString">
						content like concat('%', #{keyword}, '%')
					</if>
					<if test="val == 'w'.toString">
						writer like concat('%', #{keyword}, '%')
					</if>
				</foreach>
			</if>
		</where>
	</sql>

	<!-- INSERT -->
	<insert id="register" >
		<![CDATA[
      insert into tbl_animal (animalCode, serviceName, type, name, species,
                        sex, age, special, color, situation,
                        originURL, missingDate, missingLocation, rescueDate,
                        rescueLocation, phoneNumber, guardianName, bno, rescueStatus)

      values (#{animalCode}, #{serviceName}, #{type}, #{name}, #{species},
            #{sex}, #{age}, #{special}, #{color}, #{situation},
            #{originURL}, #{missingDate}, #{missingLocation}, #{rescueDate},
            #{rescueLocation}, #{phoneNumber}, #{guardianName}, #{bno}, #{rescueStatus})
      ]]>
		<selectKey resultType="int" keyProperty="animalNumber" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<!-- MODIFY -->
	<update id="setIsAdopted">
      <![CDATA[
		update tbl_animal set updatedate = now(), isAdopted = #{isAdopted}
		where animalNumber = #{animalNumber}
		]]>
   </update>

	<!-- List -->
	<select id="getPagedList" resultType="org.petdians.animal.domain.MissingAnimalVO">
		select * from tbl_animal
		<include refid="search"></include>
		order by bno desc limit #{skip},#{perSheet}
	</select>

	<select id="getAllList" resultType="org.petdians.animal.domain.MissingAnimalVO">
		select * from tbl_animal
	</select>

	<!-- ToTal -->
	<select id="getTotalCount" resultType="Integer">
		select count(bno) from tbl_animal
		<include refid="search"></include>
	</select>

</mapper>